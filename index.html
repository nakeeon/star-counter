<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–õ—ñ—á–∏–ª—å–Ω–∏–∫ –∑–Ω–∞–π–ª–∏–∫—ñ–≤</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap');
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:'Comic Neue','Comic Sans MS',cursive;background:linear-gradient(135deg,#e8f4fd 0%,#fff9e6 50%,#e8fde8 100%);min-height:100vh;padding:10px}
  .container{max-width:500px;margin:0 auto}
  h1{text-align:center;font-size:26px;color:#2c3e80;margin:8px 0}
  .title-icon{width:32px;height:32px;vertical-align:middle}
  .subtitle{text-align:center;font-size:15px;color:#666;margin-bottom:12px;min-height:20px}

  .setup{background:white;border-radius:20px;padding:20px;box-shadow:0 3px 15px rgba(0,0,0,0.08);margin-bottom:15px}
  .setup h2{font-size:20px;color:#2c3e80;margin-bottom:12px;text-align:center}
  .setup label{font-size:16px;color:#555;font-weight:700;display:block;margin:10px 0 4px}
  .setup input,.setup select{width:100%;padding:10px 14px;border:2px solid #e0e0e0;border-radius:12px;font-size:16px;font-family:inherit}
  .setup input:focus,.setup select:focus{outline:none;border-color:#4a90d9}
  .task-row{display:flex;gap:8px;align-items:center;margin:6px 0}
  .task-row input{flex:1}
  .task-row input.max-input{width:60px;flex:none;text-align:center}
  .task-row .remove-btn{width:32px;height:32px;border-radius:50%;border:none;background:#f0f0f0;color:#999;font-size:18px;cursor:pointer}
  .task-row .remove-btn:hover{background:#ffdddd;color:#e44}
  .add-task-btn{width:100%;padding:10px;border:2px dashed #ccc;border-radius:12px;background:none;font-size:16px;font-family:inherit;color:#888;cursor:pointer;margin:8px 0}
  .add-task-btn:hover{border-color:#4a90d9;color:#4a90d9}
  .start-btn{width:100%;padding:14px;background:linear-gradient(135deg,#4CAF50,#45a049);color:white;border:none;border-radius:14px;font-size:20px;font-weight:700;font-family:inherit;cursor:pointer;margin-top:12px;box-shadow:0 3px 12px rgba(76,175,80,0.3)}
  .start-btn:active{transform:scale(0.97)}

  .game{display:none}
  .task{background:white;border-radius:16px;padding:12px 14px;margin-bottom:8px;box-shadow:0 2px 8px rgba(0,0,0,0.06);display:flex;align-items:center;justify-content:space-between;gap:8px}
  .task-left{flex:1}
  .task-name{font-size:17px;font-weight:700;color:#333}
  .task-max{font-size:12px;color:#999}
  .task-znailyks{min-width:70px;text-align:center;display:flex;flex-wrap:wrap;justify-content:center;gap:2px}
  .znailyk-img{width:28px;height:28px;animation:znPop 0.3s ease-out}
  .znailyk-empty{width:28px;height:28px;opacity:0.15}
  @keyframes znPop{0%{transform:scale(0)}60%{transform:scale(1.3)}100%{transform:scale(1)}}
  .task-buttons{display:flex;gap:5px}
  .btn-zn{width:42px;height:42px;border-radius:50%;border:none;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;-webkit-tap-highlight-color:transparent}
  .btn-plus{background:linear-gradient(135deg,#FFD700,#FFA500);box-shadow:0 2px 6px rgba(255,165,0,0.3)}
  .btn-plus:active{transform:scale(1.2)}
  .btn-minus{background:#eee;color:#999;font-size:16px}
  .btn-minus:active{background:#ddd}

  .total-section{background:white;border-radius:20px;padding:18px;margin-top:12px;text-align:center;box-shadow:0 3px 15px rgba(0,0,0,0.08)}
  .total-label{font-size:15px;color:#888;margin-bottom:4px}
  .total-znailyks{display:flex;flex-wrap:wrap;justify-content:center;gap:3px;margin:6px 0;min-height:32px}
  .total-count{font-size:44px;font-weight:700;color:#2c3e80}

  .result-btn{background:linear-gradient(135deg,#e53935,#c62828);color:white;border:none;border-radius:30px;padding:12px 36px;font-size:20px;font-weight:700;font-family:inherit;cursor:pointer;margin-top:10px;box-shadow:0 3px 12px rgba(229,57,53,0.4)}
  .result-btn:active{transform:scale(0.95)}
  .result-box{display:none;margin-top:12px;padding:18px;border-radius:16px;text-align:center;animation:popIn 0.4s ease-out}
  @keyframes popIn{0%{transform:scale(0.5);opacity:0}70%{transform:scale(1.1)}100%{transform:scale(1);opacity:1}}
  .result-emoji{font-size:52px}
  .result-color{font-size:24px;font-weight:700;margin:6px 0}
  .result-text{font-size:18px;color:#555}
  .reset-row{display:flex;gap:8px;justify-content:center;margin-top:12px}
  .reset-btn,.edit-btn{background:none;border:2px solid #ddd;border-radius:20px;padding:8px 20px;font-size:14px;font-family:inherit;color:#999;cursor:pointer}
  .reset-btn:active,.edit-btn:active{background:#f5f5f5}

  .lego{display:inline-block;width:32px;height:20px;border-radius:4px;vertical-align:middle;margin-right:4px;position:relative;box-shadow:0 2px 4px rgba(0,0,0,0.2)}
  .lego::before{content:'';position:absolute;top:-6px;left:4px;width:8px;height:6px;border-radius:3px 3px 0 0;background:inherit}
  .lego::after{content:'';position:absolute;top:-6px;left:20px;width:8px;height:6px;border-radius:3px 3px 0 0;background:inherit}
  .lego-green{background:#2e7d32}
  .lego-blue{background:#1565c0}
  .lego-orange{background:#e65100}
  .lego-yellow{background:#f9a825}

  .color-legend{display:flex;gap:6px;flex-wrap:wrap;justify-content:center;margin:8px 0;font-size:12px;font-weight:700}
  .color-legend span{padding:3px 8px;border-radius:8px;display:flex;align-items:center;gap:3px}
  .cl-green{background:#e8f5e9;color:#2e7d32}
  .cl-blue{background:#e3f2fd;color:#1565c0}
  .cl-orange{background:#fff3e0;color:#e65100}
  .cl-yellow{background:#fffde7;color:#f9a825}

  .confetti-piece{position:fixed;border-radius:2px;animation:confettiFall 3s ease-out forwards;pointer-events:none;z-index:1000}
  @keyframes confettiFall{0%{transform:translateY(-10px) rotate(0deg);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}

  .threshold-row{display:flex;gap:6px;margin:6px 0;flex-wrap:wrap;align-items:center}
  .threshold-row span{font-size:14px;display:flex;align-items:center;gap:3px}
  .threshold-row input{width:50px;padding:4px;border:1px solid #ccc;border-radius:6px;font-size:14px;text-align:center}
</style>
</head>
<body>
<div class="container">
  <h1><img class="title-icon" src="data:image/png;base64,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"> –õ—ñ—á–∏–ª—å–Ω–∏–∫ –∑–Ω–∞–π–ª–∏–∫—ñ–≤</h1>
  <p class="subtitle" id="lessonName"></p>

  <div class="setup" id="setup">
    <h2>‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —É—Ä–æ–∫—É</h2>
    <label>–ù–∞–∑–≤–∞ —É—Ä–æ–∫—É:</label>
    <input type="text" id="inputLesson" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞ ‚Äî –í–µ–ª–∏–∫–∞ –±—É–∫–≤–∞">
    
    <label>–ó–∞–≤–¥–∞–Ω–Ω—è:</label>
    <div id="taskList"></div>
    <button class="add-task-btn" onclick="addTaskRow()">+ –î–æ–¥–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è</button>

    <label>–ö–æ–ª—å–æ—Ä–æ–≤–µ –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è:</label>
    <div class="threshold-row">
      <span><span class="lego lego-green" style="width:20px;height:13px"></span> –≤—ñ–¥ <input type="number" id="greenMin" value="80">%</span>
      <span><span class="lego lego-blue" style="width:20px;height:13px"></span> –≤—ñ–¥ <input type="number" id="blueMin" value="55">%</span>
      <span><span class="lego lego-orange" style="width:20px;height:13px"></span> –≤—ñ–¥ <input type="number" id="orangeMin" value="30">%</span>
      <span><span class="lego lego-yellow" style="width:20px;height:13px"></span> —Ä–µ—à—Ç–∞</span>
    </div>

    <button class="start-btn" onclick="startGame()">‚úÖ –ü–æ—á–∞—Ç–∏ —É—Ä–æ–∫!</button>
  </div>

  <div class="game" id="game">
    <div id="tasks"></div>
    <div class="total-section">
      <div class="total-label">–£—Å—å–æ–≥–æ –∑–Ω–∞–π–ª–∏–∫—ñ–≤:</div>
      <div class="total-znailyks" id="totalZnailyks"></div>
      <div class="total-count" id="totalCount">0</div>
      <div class="color-legend">
        <span class="cl-green" id="lgGreen"><span class="lego lego-green" style="width:16px;height:10px"></span> ?+</span>
        <span class="cl-blue" id="lgBlue"><span class="lego lego-blue" style="width:16px;height:10px"></span> ?+</span>
        <span class="cl-orange" id="lgOrange"><span class="lego lego-orange" style="width:16px;height:10px"></span> ?+</span>
        <span class="cl-yellow" id="lgYellow"><span class="lego lego-yellow" style="width:16px;height:10px"></span> 0+</span>
      </div>
      <button class="result-btn" onclick="showResult()">üé® –í–∏–∑–Ω–∞—á —Å–≤—ñ–π –∫–æ–ª—ñ—Ä!</button>
      <div class="result-box" id="resultBox">
        <div class="result-emoji" id="resultEmoji"></div>
        <div class="result-color" id="resultColor"></div>
        <div class="result-text" id="resultText"></div>
      </div>
      <div class="reset-row">
        <button class="reset-btn" onclick="resetAll()">üîÑ –°–ø–æ—á–∞—Ç–∫—É</button>
        <button class="edit-btn" onclick="editSetup()">‚öôÔ∏è –ó–º—ñ–Ω–∏—Ç–∏ —É—Ä–æ–∫</button>
      </div>
    </div>
  </div>
</div>

<script>
const COIN = "data:image/png;base64,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";
const COIN_BIG = "data:image/png;base64,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";

let tasks=[], state=[], thresholds={green:80,blue:55,orange:30};

const defaultTasks = [
  {name:"–ó–∞–≤–¥–∞–Ω–Ω—è 1", max:2},
  {name:"–ó–∞–≤–¥–∞–Ω–Ω—è 2", max:2},
  {name:"–ó–∞–≤–¥–∞–Ω–Ω—è 3", max:3},
];

function init(){
  const params = new URLSearchParams(window.location.search);
  if(params.has('config')){
    try{
      const cfg = JSON.parse(atob(params.get('config')));
      document.getElementById('inputLesson').value = cfg.lesson||'';
      loadTaskRows(cfg.tasks||defaultTasks);
      if(cfg.thresholds){
        document.getElementById('greenMin').value=cfg.thresholds.green||80;
        document.getElementById('blueMin').value=cfg.thresholds.blue||55;
        document.getElementById('orangeMin').value=cfg.thresholds.orange||30;
      }
      return;
    }catch(e){}
  }
  const saved = localStorage.getItem('znailyk_setup');
  if(saved){
    try{
      const cfg=JSON.parse(saved);
      document.getElementById('inputLesson').value=cfg.lesson||'';
      loadTaskRows(cfg.tasks||defaultTasks);
      if(cfg.thresholds){
        document.getElementById('greenMin').value=cfg.thresholds.green||80;
        document.getElementById('blueMin').value=cfg.thresholds.blue||55;
        document.getElementById('orangeMin').value=cfg.thresholds.orange||30;
      }
      return;
    }catch(e){}
  }
  loadTaskRows(defaultTasks);
}

function loadTaskRows(list){
  document.getElementById('taskList').innerHTML='';
  list.forEach(t=>addTaskRow(t.name,t.max));
}

function addTaskRow(name,max){
  const div=document.createElement('div');
  div.className='task-row';
  div.innerHTML='<input type="text" placeholder="–ù–∞–∑–≤–∞ –∑–∞–≤–¥–∞–Ω–Ω—è" value="'+(name||'')+'" class="task-name-input">' +
    '<input type="number" min="1" max="10" value="'+(max||2)+'" class="max-input" title="–ú–∞–∫—Å. –∑–Ω–∞–π–ª–∏–∫—ñ–≤">' +
    '<button class="remove-btn" onclick="this.parentElement.remove()">√ó</button>';
  document.getElementById('taskList').appendChild(div);
}

function startGame(){
  const lesson=document.getElementById('inputLesson').value.trim();
  const rows=document.querySelectorAll('.task-row');
  if(rows.length===0){alert('–î–æ–¥–∞–π —Ö–æ—á–∞ –± –æ–¥–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è!');return}
  
  tasks=[];
  rows.forEach((r,i)=>{
    const name=r.querySelector('.task-name-input').value.trim()||('–ó–∞–≤–¥–∞–Ω–Ω—è '+(i+1));
    const max=parseInt(r.querySelector('.max-input').value)||2;
    tasks.push({name,max});
  });
  
  thresholds={
    green:parseInt(document.getElementById('greenMin').value)||80,
    blue:parseInt(document.getElementById('blueMin').value)||55,
    orange:parseInt(document.getElementById('orangeMin').value)||30,
  };
  
  localStorage.setItem('znailyk_setup',JSON.stringify({lesson,tasks,thresholds}));
  
  state=tasks.map(()=>0);
  document.getElementById('lessonName').textContent=lesson;
  
  const maxTotal=tasks.reduce((a,t)=>a+t.max,0);
  const gn=Math.ceil(maxTotal*thresholds.green/100);
  const bn=Math.ceil(maxTotal*thresholds.blue/100);
  const on=Math.ceil(maxTotal*thresholds.orange/100);
  document.getElementById('lgGreen').innerHTML='<span class="lego lego-green" style="width:16px;height:10px"></span> '+gn+'+';
  document.getElementById('lgBlue').innerHTML='<span class="lego lego-blue" style="width:16px;height:10px"></span> '+bn+'+';
  document.getElementById('lgOrange').innerHTML='<span class="lego lego-orange" style="width:16px;height:10px"></span> '+on+'+';
  document.getElementById('lgYellow').innerHTML='<span class="lego lego-yellow" style="width:16px;height:10px"></span> 0-'+(on-1);
  
  document.getElementById('setup').style.display='none';
  document.getElementById('game').style.display='block';
  render();
}

function render(){
  const container=document.getElementById('tasks');
  container.innerHTML='';
  tasks.forEach((task,i)=>{
    const div=document.createElement('div');div.className='task';
    let zn='';
    for(let j=0;j<task.max;j++){
      if(j<state[i]) zn+='<img src="'+COIN+'" class="znailyk-img">';
      else zn+='<img src="'+COIN+'" class="znailyk-empty">';
    }
    div.innerHTML='<div class="task-left"><div class="task-name">'+task.name+'</div><div class="task-max">–º–∞–∫—Å. '+task.max+'</div></div>'+
      '<div class="task-znailyks">'+zn+'</div>'+
      '<div class="task-buttons"><button class="btn-zn btn-minus" onclick="remove('+i+')">‚àí</button><button class="btn-zn btn-plus" onclick="add('+i+')"><img src="'+COIN+'" style="width:24px;height:24px"></button></div>';
    container.appendChild(div);
  });
  updateTotal();
}

function add(i){if(state[i]<tasks[i].max){state[i]++;render();document.getElementById('resultBox').style.display='none'}}
function remove(i){if(state[i]>0){state[i]--;render();document.getElementById('resultBox').style.display='none'}}
function getTotal(){return state.reduce((a,b)=>a+b,0)}
function getMax(){return tasks.reduce((a,t)=>a+t.max,0)}

function updateTotal(){
  const total=getTotal();
  document.getElementById('totalCount').textContent=total;
  const tz=document.getElementById('totalZnailyks');tz.innerHTML='';
  for(let i=0;i<total;i++){const img=document.createElement('img');img.src=COIN_BIG;img.style.width='24px';img.style.height='24px';tz.appendChild(img)}
}

function legoSpan(cls){return '<span class="lego '+cls+'"></span>'}

function showResult(){
  const total=getTotal(), max=getMax();
  const pct=max>0?total/max*100:0;
  const box=document.getElementById('resultBox');
  let emoji,colorName,color,text,bg;
  if(pct>=thresholds.green){
    emoji='üèÜüéâüåü';colorName=legoSpan('lego-green')+' –ó–ï–õ–ï–ù–ò–ô ‚Äî –¢–í–Ü–ô –£–°–ü–Ü–•!';color='#2e7d32';text='–¢–∏ —á—É–¥–æ–≤–æ –ø–æ–ø—Ä–∞—Ü—é–≤–∞–≤! –ü–∏—à–∞—é—Å—è —Ç–æ–±–æ—é!';bg='linear-gradient(135deg,#e8f5e9,#c8e6c9)';launchConfetti();
  }else if(pct>=thresholds.blue){
    emoji='üëèüí™';colorName=legoSpan('lego-blue')+' –°–ò–ù–Ü–ô ‚Äî –ú–ê–ô–ñ–ï –í–î–ê–õ–û–°–Ø!';color='#1565c0';text='–ì–∞—Ä–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –¢—Ä—ñ—à–∫–∏ –ø–æ–ø—Ä–∞—Ü—é–π —ñ –±—É–¥–µ —ñ–¥–µ–∞–ª—å–Ω–æ!';bg='linear-gradient(135deg,#e3f2fd,#bbdefb)';launchConfetti();
  }else if(pct>=thresholds.orange){
    emoji='ü§óüí™';colorName=legoSpan('lego-orange')+' –û–†–ê–ù–ñ–ï–í–ò–ô ‚Äî –ë–£–õ–û –í–ê–ñ–ö–û';color='#e65100';text='–ù–µ —Å—É–º—É–π! –ü–æ–≤—Ç–æ—Ä–∏ —ñ —Å–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑!';bg='linear-gradient(135deg,#fff3e0,#ffe0b2)';
  }else{
    emoji='ü§ù‚ù§Ô∏è';colorName=legoSpan('lego-yellow')+' –ñ–û–í–¢–ò–ô ‚Äî –ü–û–¢–†–ï–ë–£–Ñ–® –î–û–ü–û–ú–û–ì–ò';color='#f9a825';text='–ù–µ —Å—É–º—É–π! –ú–∏ –¥–æ–ø–æ–º–æ–∂–µ–º–æ —Ä–∞–∑–æ–º!';bg='linear-gradient(135deg,#fffde7,#fff9c4)';
  }
  box.style.display='block';box.style.background=bg;
  document.getElementById('resultEmoji').textContent=emoji;
  document.getElementById('resultColor').innerHTML=colorName;
  document.getElementById('resultColor').style.color=color;
  document.getElementById('resultText').textContent=text+' ('+total+'/'+max+')';
  box.style.animation='none';box.offsetHeight;box.style.animation='popIn 0.4s ease-out';
}

function resetAll(){
  if(getTotal()>0&&!confirm('–ü–æ—á–∞—Ç–∏ —Å–ø–æ—á–∞—Ç–∫—É? –£—Å—ñ –∑–Ω–∞–π–ª–∏–∫–∏ –∑–Ω–∏–∫–Ω—É—Ç—å!'))return;
  state.fill(0);document.getElementById('resultBox').style.display='none';render();
}

function editSetup(){
  document.getElementById('setup').style.display='block';
  document.getElementById('game').style.display='none';
  loadTaskRows(tasks.map(t=>({name:t.name,max:t.max})));
}

function launchConfetti(){
  const colors=['#FFD700','#FF6B6B','#4CAF50','#2196F3','#FF9800','#9C27B0'];
  for(let i=0;i<35;i++){setTimeout(()=>{const p=document.createElement('div');p.className='confetti-piece';p.style.left=Math.random()*100+'vw';p.style.background=colors[Math.floor(Math.random()*colors.length)];p.style.animationDuration=(2+Math.random()*2)+'s';p.style.width=(6+Math.random()*8)+'px';p.style.height=(6+Math.random()*8)+'px';document.body.appendChild(p);setTimeout(()=>p.remove(),4000)},i*50)}
}

init();
</script>
</body>
</html>